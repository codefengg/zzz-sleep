<nav-bar title="睡眠" id="navBar"></nav-bar>

<view class="container" style="padding-top: {{navBarHeight}}px;">
  <!-- 背景图片 -->
  <image class="background-image" src="../../assets/background-vector.png"></image>
  
  <!-- 标题区 -->
  <view class="header-section">
    <view class="header-text">
      <view class="main-title">夜深了</view>
      <view class="sub-title">
        春风拂过，万物复苏，每一片新叶都在诉说生长的力量。这是一个崭新的起点，泥土中的种子正破土而出，正如你心中蛰伏的梦想——只要向上，必有回响。
      </view>
    </view>
    <view class="header-icon">
      <view class="moon"></view>
    </view>
  </view>

  <!-- 音频列表区 -->
  <view class="audio-list">
    <block wx:for="{{audioList}}" wx:key="id">
      <view 
        class="audio-item" 
        style="width:{{itemWidth}}px;height:{{itemWidth}}px"
        bindtap="onTapAudioItem"
        data-id="{{item.id}}"
      >
        <view class="audio-item-inner">
          <image 
            class="audio-item-bg" 
            src="{{item.backgroundImage || '/assets/default-bg.jpg'}}" 
            mode="aspectFill"
          ></image>
          <view class="audio-item-content">
            <image 
              class="audio-item-icon" 
              src="{{item.icon}}" 
              mode="aspectFit"
            ></image>
            <view class="audio-item-name">{{item.name}}</view>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- 使用play-panel组件 -->
  <play-panel 
    bind:statechange="onPlayerStateChange"
    bind:progresschange="onPlayerProgressChange">
    
    <!-- 迷你播放器内容 -->
    <view slot="mini-player" class="mini-player-content">
      <view class="mini-player-info">
        <image class="mini-player-cover" src="{{currentAudio.backgroundImage}}" mode="aspectFill"></image>
        <view class="mini-player-text">
          <view class="mini-player-name">{{currentAudio.name}}</view>
          <view class="mini-player-time">{{currentTime}}/{{duration}}</view>
        </view>
      </view>
      <view class="mini-player-controls">
        <view class="play-button {{isPlaying ? 'playing' : ''}}" catchtap="togglePlay"></view>
      </view>
    </view>
    
    <!-- 全屏播放器内容 -->
    <view slot="full-player" class="full-player-content">
      <view class="full-player-header">
        <view class="full-player-title">正在播放</view>
      </view>
      
      <view class="full-player-cover-wrapper">
        <image class="full-player-cover {{isPlaying ? 'rotating' : ''}}" 
          src="{{currentAudio.backgroundImage}}" mode="aspectFill"></image>
      </view>
      
      <view class="full-player-info">
        <view class="full-player-name">{{currentAudio.name}}</view>
      </view>
      
      <view class="full-player-progress">
        <view class="time-info">
          <text class="current-time">{{currentTime}}</text>
          <text class="duration">{{duration}}</text>
        </view>
        <slider 
          class="progress-slider" 
          block-size="12" 
          activeColor="#ffffff" 
          backgroundColor="rgba(255,255,255,0.2)" 
          value="{{sliderValue}}"
          bindchange="onSliderChange"
        ></slider>
      </view>
      
      <view class="full-player-controls">
        <view class="control-button prev-button"></view>
        <view class="control-button play-button {{isPlaying ? 'playing' : ''}}" catchtap="togglePlay"></view>
        <view class="control-button next-button"></view>
      </view>
    </view>
    
  </play-panel>
</view>